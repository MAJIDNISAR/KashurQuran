"use strict";!function(a){var b={pluralize:function(a,b){return 1===b?a:a+"s"},format:function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=new RegExp("\\{"+(b-1)+"\\}","gm");a=a.replace(c,arguments[b])}return a}},c={Constants:{TOOLTIP_CONTAINER:"body",TOOLTIP_PLACEMENT:"left",TOOLTIP_TRIGGER:"hover",UPLOADER_AUTO_UPLOAD:!0,UPLOADER_SEQUENTIAL_UPLOADS:!0},CssClasses:{DRIVE:"drive",DRIVE_TOOLBAR:"drive-toolbar",DRIVE_UPLOADER:"drive-uploader",DRIVE_UPLOADER_BTN:"drive-uploader-btn",DRIVE_DRAGOVER:"drive-dragover",UPLOADER_FILES_CONTAINER:"file-list",HAS_FILES:"has-files",HOVER:"hover",SELECTED:"selected"},init:function(){this.$body=a(document.body),this.$drive=a("."+this.CssClasses.DRIVE),this.$toolbar=a("."+this.CssClasses.DRIVE_TOOLBAR),this.$uploader=a("."+this.CssClasses.DRIVE_UPLOADER),this.$uploaderBtn=a("."+this.CssClasses.DRIVE_UPLOADER_BTN),this.$list=a("."+this.CssClasses.UPLOADER_FILES_CONTAINER),this.$tooltipBtns=a("button[data-toggle]"),this.currentFiles=[],this.uploader().bindEvents(),this.tooltips()},uploader:function(){var a=this.getUploaderOptions();return a.dropZone=this.$drive,a.filesContainer=this.$list,this.$uploader.fileupload(a),this},tooltips:function(){var a=this.getTooltipOptions();this.$tooltipBtns.tooltip(a)},bindEvents:function(){a(document).on("mouseenter.e.drive",".file",this.handleFileMouseEnter.bind(this)).on("mouseleave.e.drive",".file",this.handleFileMouseLeave.bind(this)).on("change.e.drive",".file-select-input",this.handleFileSelectInputChange.bind(this)).on("dragover.e.drive",this.handleFileUploadDragover.bind(this)).on("drop.e.drive",this.handleFileUploadDrop.bind(this)).on("fileuploadstart.e.drive",this.handleFileUploadStart.bind(this)).on("fileuploaddone.e.drive",this.handleFileUploadDone.bind(this)).on("fileuploadfail.e.drive",this.handleFileUploadFail.bind(this)).on("fileuploadstop.e.drive",this.handleFileUploadStop.bind(this)),a('[data-toggle="uploader"]').on("click.e.drive",this.handleUploaderBtnClick.bind(this))},handleFileMouseEnter:function(b){a(b.currentTarget).addClass(this.CssClasses.HOVER)},handleFileMouseLeave:function(b){a(b.currentTarget).removeClass(this.CssClasses.HOVER)},handleFileSelectInputChange:function(b){var c=a(b.currentTarget);this.selectItem(c),this.toggleToolbar()},handleFileUploadDragover:function(b){var c=this.$drive,d=b.target;clearTimeout(this.dropZoneTimeoutId);do if(a(d).is(c)){c.addClass(this.CssClasses.DRIVE_DRAGOVER);break}while(d=d.parentNode);this.dropZoneTimeoutId=setTimeout(function(){c.removeClass(this.CssClasses.DRIVE_DRAGOVER)}.bind(this),100),b.preventDefault()},handleFileUploadDrop:function(a){a.preventDefault()},handleFileUploadStart:function(a){var b=this.hasItems();this.$body.toggleClass(this.CssClasses.HAS_FILES,b)},handleFileUploadDone:function(a,b){var c=b.getFilesFromResponse,d=c(b);b.context&&b.context.each(function(a){var b=d[a]||{error:"Empty file upload result."};this.registerUpload(b)}.bind(this))},handleFileUploadFail:function(a,b){b.context&&b.context.each(function(a){var c=b.files[index];c.error=c.error||b.errorThrown||b.i18n("unknownError"),this.registerUpload(c)}.bind(this))},handleFileUploadStop:function(a){this.showCompletedNotification(),this.showFailedNotification(),this.currentFiles=[]},handleUploaderBtnClick:function(a){this.$uploaderBtn.trigger("click")},registerUpload:function(a){this.currentFiles.push(a)},getCompletedUploads:function(){return this.currentFiles.filter(function(a){return"undefined"==typeof a.error})},getFailedUploads:function(){return this.currentFiles.filter(function(a){return"string"==typeof a.error})},showNotification:function(a){toastr[a.type](a.message,a.title)},showCompletedNotification:function(){var a,c,d=this.getCompletedUploads();(a=d.length)&&(c=b.pluralize("item",a),this.showNotification({message:b.format("Uploaded {0} {1}",a,c),type:"success"}))},showFailedNotification:function(){var a=this.getFailedUploads();a.forEach(function(a){this.showNotification({title:a.name,message:a.error,type:"error"})}.bind(this))},selectItem:function(a){var b=a.closest(".file"),c=a.is(":checked");b.toggleClass(this.CssClasses.SELECTED,c)},getItems:function(){return this.$list.children()},hasItems:function(){return!!this.getItems().length},getSelectedItems:function(){var a=this.getItems();return a.filter("."+this.CssClasses.SELECTED)},hasSelectedItems:function(){return!!this.getSelectedItems().length},toggleToolbar:function(){var a=this.hasSelectedItems();this.$toolbar.collapse(a?"show":"hide")},getUploaderOptions:function(){return this.getCreateOptions("uploader")},getTooltipOptions:function(){return this.getCreateOptions("tooltip")},getCreateOptions:function(b,c){var d=new RegExp("^"+b+"(_)?","i"),e={};return a.each(this,function(b,f){a.isPlainObject(f)&&a.each(f,function(f,g){d.test(f)&&(f=f.replace(d,"").replace(/_/g,"-"),f=a.camelCase(f.toLowerCase()),c&&c(e,b,f,g)||(e[f]=g))})}),e}};c.init()}(jQuery);